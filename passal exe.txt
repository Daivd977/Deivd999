-- Inicialização da UI (baseado no seu script)
local WINDU = loadstring(game:HttpGet("https://raw.githubusercontent.com/7GrandDadPGN/VapeV4ForRoblox/main/NewMainScript.lua", true))()
local Version = "1.4.0"
local WINDUUI = loadstring(game:HttpGet("https://raw.githubusercontent.com/7GrandDadPGN/VapeV4ForRoblox/main/ui.lua", true))()

-- Criação da janela e do tab
local ubatuba = WINDU:CreateWindow({
    Title = "Lolita Hub teste",
    Icon = "door-open",
    Author = "LOLYCON666",
    Folder = "Lolita Hub v.1.0",
    Size = UDim2.fromOffset(580, 460),
    KeySystem = {
        CreatesKeySystem = true,
        Key = "666",
        Note = "pode nao man",
        URL = "https://link-hub.vercel.app/api/UI/WINDU/",
        SaveKey = false,
        Transparent = true,
        Theme = "Dark",
        SideBarWidth = 260,
        HasOutline = false
    }
})

local Tab = ubatuba:NewTab({
    Title = "teste",
    Icon = "house"
})

-- Script da bola
local localPlayer = game.Players.LocalPlayer
local ball = game.Workspace:WaitForChild("SoccerBall") -- A bola vista no Explorer
local isFollowing = false
local selectedPlayerName = nil

-- Função para obter a lista de jogadores (excluindo o jogador local)
local function getPlayerNames()
    local players = game.Players:GetPlayers()
    local playerNames = {}
    for _, player in ipairs(players) do
        if player ~= localPlayer then
            table.insert(playerNames, player.Name)
        end
    end
    return playerNames
end

-- Criar o Dropdown para selecionar jogadores
local playerNames = getPlayerNames()
local Dropdown = Tab:NewDropdown("Select Player", "Choose a player for the ball to follow", playerNames, function(selected)
    selectedPlayerName = selected
end)

-- Função para iniciar o seguimento da bola
local function startFollowing()
    if not selectedPlayerName then
        return
    end
    isFollowing = true
    ball.Anchored = true
    coroutine.wrap(function()
        while isFollowing do
            local player = game.Players:FindFirstChild(selectedPlayerName)
            if player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                -- Posiciona a bola na altura do HumanoidRootPart (aproximadamente a barriga)
                ball.CFrame = player.Character.HumanoidRootPart.CFrame
            else
                break -- Para se o jogador sair do jogo
            end
            wait()
        end
        ball.Anchored = false -- Desancora a bola quando parar
    end)()
end

-- Função para parar o seguimento
local function stopFollowing()
    isFollowing = false
end

-- Criar o Toggle para ativar/desativar o seguimento
local Toggle = Tab:NewToggle("Follow Player", "Toggle to start/stop following", false, function(state)
    if state then
        startFollowing()
    else
        stopFollowing()
    end
end)

-- Atualizar o dropdown dinamicamente quando jogadores entram/saem
game.Players.PlayerAdded:Connect(function()
    local newPlayerNames = getPlayerNames()
    Dropdown:Refresh(newPlayerNames)
    if not table.find(newPlayerNames, selectedPlayerName) then
        selectedPlayerName = nil
    end
end)

game.Players.PlayerRemoving:Connect(function(player)
    local newPlayerNames = getPlayerNames()
    Dropdown:Refresh(newPlayerNames)
    if player.Name == selectedPlayerName then
        selectedPlayerName = nil
        stopFollowing()
    end
end)
